<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Capture and Analysis</title>
</head>
<body>
    <button id="start">Start Listening</button>
    <script type="module">
        import AudioProcessor from './index.js'
        const button = document.getElementById('start')
        button.addEventListener('click', async () => {
          const a = new AudioProcessor()
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                const analyser = audioContext.createAnalyser();

                source.connect(analyser);
                analyser.fftSize = 32768; // Or whatever size you need
                analyser.smoothingTimeConstant = 0
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);

                const draw = () => {
                    requestAnimationFrame(draw);

                    analyser.getByteFrequencyData(dataArray);

                    // This is where the magic happens, but be careful what you log...
                    console.log({
                      energy: a.energy(dataArray),
                      spectralCentroid: a.spectralCentroid(dataArray),
                      spectralCrest: a.spectralCrest(dataArray),
                      spectralEntropy: a.spectralEntropy(dataArray),
                      spectralFlux: a.spectralFlux(dataArray),
                      spectralKurtosis: a.spectralKurtosis(dataArray),
                      spectralRolloff: a.spectralRolloff(dataArray),
                      spectralRoughness: a.spectralRoughness(dataArray),
                      spectralSkew: a.spectralSkew(dataArray),
                      spectralSpread: a.spectralSpread(dataArray),
                    });
                };

                draw();
            } catch (error) {
                console.error('Something went wrong:', error);
            }
        });
    </script>
</body>
</html>
